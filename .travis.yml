language: java

dist: xenial

git:
  depth: false
  
addons:
  sonarcloud:
    organization: "alessandroferi"
    
matrix:
  include: 
  - jdk: openjdk11
    env: ADDITIONAL_MAVEN_ARGS="-Pjacoco coveralls:report sonar:sonar"
  - jdk: openjdk11
    if: type IN (pull_request)
    env: ADDITIONAL_MAVEN_ARGS="-Pintegration-tests"
  - jdk: openjdk11
    if: type IN (pull_request)
    env: ADDITIONAL_MAVEN_ARGS="-Pe2e-tests"
  - jdk: openjdk11
    if: type IN (pull_request)
    env: ADDITIONAL_MAVEN_ARGS="-Ppit"
    
services: 
  - xvfb
  - docker
    
install: true

cache:
  directories:
    - $HOME/.m2
    - $HOME/.sonar/cache 
    
script:
  - mvn -f bookshop-project2/pom.xml clean verify $ADDITIONAL_MAVEN_ARGS